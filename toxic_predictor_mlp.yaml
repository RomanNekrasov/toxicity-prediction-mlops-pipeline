# PIPELINE DEFINITION
# Name: toxic-predictor-mlp
# Inputs:
#    data_bucket: str
#    model_repo: str
#    project_id: str
#    trainset_filename: str
components:
  comp-multilabel-classifier:
    executorLabel: exec-multilabel-classifier
    inputDefinitions:
      artifacts:
        train:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        model_bucket:
          parameterType: STRING
        project:
          parameterType: STRING
    outputDefinitions:
      parameters:
        metrics:
          parameterType: STRING
  comp-toxic-data-cleaner:
    executorLabel: exec-toxic-data-cleaner
    inputDefinitions:
      artifacts:
        features:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
    outputDefinitions:
      artifacts:
        cleaned_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
  comp-toxic-data-ingestion:
    executorLabel: exec-toxic-data-ingestion
    inputDefinitions:
      parameters:
        bucket:
          parameterType: STRING
        data_file_name:
          parameterType: STRING
        project:
          parameterType: STRING
    outputDefinitions:
      artifacts:
        features:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
  comp-toxic-predictor:
    executorLabel: exec-toxic-predictor
    inputDefinitions:
      artifacts:
        test:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        model_bucket:
          parameterType: STRING
        project:
          parameterType: STRING
    outputDefinitions:
      parameters:
        metrics:
          parameterType: STRING
  comp-toxic-train-test-split:
    executorLabel: exec-toxic-train-test-split
    inputDefinitions:
      artifacts:
        cleaned_data:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
    outputDefinitions:
      artifacts:
        test:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
        train:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
deploymentSpec:
  executors:
    exec-multilabel-classifier:
      container:
        args:
        - --project_id
        - '{{$.inputs.parameters[''project'']}}'
        - --train_path
        - '{{$.inputs.artifacts[''train''].path}}'
        - --model_repo
        - '{{$.inputs.parameters[''model_bucket'']}}'
        - --metrics_path
        - '{{$.outputs.parameters[''metrics''].output_file}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-multilabel-trainer:0.0.1
    exec-toxic-data-cleaner:
      container:
        args:
        - --dataframe_path
        - '{{$.inputs.artifacts[''features''].path}}'
        - --cleaned_data_path
        - '{{$.outputs.artifacts[''cleaned_data''].path}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-data-cleaner:0.0.1
    exec-toxic-data-ingestion:
      container:
        args:
        - --project_id
        - '{{$.inputs.parameters[''project'']}}'
        - --bucket
        - '{{$.inputs.parameters[''bucket'']}}'
        - --file_name
        - '{{$.inputs.parameters[''data_file_name'']}}'
        - --feature_path
        - '{{$.outputs.artifacts[''features''].path}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-data-ingestor:0.0.1
    exec-toxic-predictor:
      container:
        args:
        - --project_id
        - '{{$.inputs.parameters[''project'']}}'
        - --predict_data
        - '{{$.inputs.artifacts[''test''].path}}'
        - --model_repo
        - '{{$.inputs.parameters[''model_bucket'']}}'
        - --metrics_path
        - '{{$.outputs.parameters[''metrics''].output_file}}'
        - --validation_data
        - 'True'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-predictor:0.0.1
    exec-toxic-train-test-split:
      container:
        args:
        - --clean_data_path
        - '{{$.inputs.artifacts[''cleaned_data''].path}}'
        - --train_path
        - '{{$.outputs.artifacts[''train''].path}}'
        - --test_path
        - '{{$.outputs.artifacts[''test''].path}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-train-test-split:0.0.1
pipelineInfo:
  name: toxic-predictor-mlp
root:
  dag:
    tasks:
      multilabel-classifier:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-multilabel-classifier
        dependentTasks:
        - toxic-train-test-split
        inputs:
          artifacts:
            train:
              taskOutputArtifact:
                outputArtifactKey: train
                producerTask: toxic-train-test-split
          parameters:
            model_bucket:
              componentInputParameter: model_repo
            project:
              componentInputParameter: project_id
        taskInfo:
          name: multilabel-classifier
      toxic-data-cleaner:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-toxic-data-cleaner
        dependentTasks:
        - toxic-data-ingestion
        inputs:
          artifacts:
            features:
              taskOutputArtifact:
                outputArtifactKey: features
                producerTask: toxic-data-ingestion
        taskInfo:
          name: toxic-data-cleaner
      toxic-data-ingestion:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-toxic-data-ingestion
        inputs:
          parameters:
            bucket:
              componentInputParameter: data_bucket
            data_file_name:
              componentInputParameter: trainset_filename
            project:
              componentInputParameter: project_id
        taskInfo:
          name: toxic-data-ingestion
      toxic-predictor:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-toxic-predictor
        dependentTasks:
        - toxic-train-test-split
        inputs:
          artifacts:
            test:
              taskOutputArtifact:
                outputArtifactKey: test
                producerTask: toxic-train-test-split
          parameters:
            model_bucket:
              componentInputParameter: model_repo
            project:
              componentInputParameter: project_id
        taskInfo:
          name: toxic-predictor
      toxic-train-test-split:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-toxic-train-test-split
        dependentTasks:
        - toxic-data-cleaner
        inputs:
          artifacts:
            cleaned_data:
              taskOutputArtifact:
                outputArtifactKey: cleaned_data
                producerTask: toxic-data-cleaner
        taskInfo:
          name: toxic-train-test-split
  inputDefinitions:
    parameters:
      data_bucket:
        parameterType: STRING
      model_repo:
        parameterType: STRING
      project_id:
        parameterType: STRING
      trainset_filename:
        parameterType: STRING
schemaVersion: 2.1.0
sdkVersion: kfp-2.3.0
