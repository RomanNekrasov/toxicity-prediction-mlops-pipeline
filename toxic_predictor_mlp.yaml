# PIPELINE DEFINITION
# Name: toxic-predictor-mlp
# Inputs:
#    data_bucket: str
#    model_repo: str
#    project_id: str
#    trainset_filename: str
components:
  comp-multilabel-classifier:
    executorLabel: exec-multilabel-classifier
    inputDefinitions:
      artifacts:
        X_dtm:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
        y:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
      parameters:
        model_bucket:
          parameterType: STRING
        project:
          parameterType: STRING
    outputDefinitions:
      parameters:
        metrics:
          parameterType: STRING
  comp-toxic-data-cleaning:
    executorLabel: exec-toxic-data-cleaning
    inputDefinitions:
      artifacts:
        features:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
    outputDefinitions:
      artifacts:
        X_dtm:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
        y:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
  comp-toxic-data-ingestion:
    executorLabel: exec-toxic-data-ingestion
    inputDefinitions:
      parameters:
        bucket:
          parameterType: STRING
        data_file_name:
          parameterType: STRING
        project:
          parameterType: STRING
    outputDefinitions:
      artifacts:
        features:
          artifactType:
            schemaTitle: system.Artifact
            schemaVersion: 0.0.1
deploymentSpec:
  executors:
    exec-multilabel-classifier:
      container:
        args:
        - --project_id
        - '{{$.inputs.parameters[''project'']}}'
        - --X_dtm
        - '{{$.inputs.artifacts[''X_dtm''].path}}'
        - y
        - '{{$.inputs.artifacts[''y''].path}}'
        - --model_repo
        - '{{$.inputs.parameters[''model_bucket'']}}'
        - --metrics_path
        - '{{$.outputs.parameters[''metrics''].output_file}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-multilabel-trainer:0.0.1
    exec-toxic-data-cleaning:
      container:
        args:
        - --dataset
        - '{{$.inputs.artifacts[''features''].path}}'
        - --X_dtm
        - '{{$.outputs.artifacts[''X_dtm''].path}}'
        - --y
        - '{{$.outputs.artifacts[''y''].path}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-data-cleaner:0.0.1
    exec-toxic-data-ingestion:
      container:
        args:
        - --project_id
        - '{{$.inputs.parameters[''project'']}}'
        - --bucket
        - '{{$.inputs.parameters[''bucket'']}}'
        - --file_name
        - '{{$.inputs.parameters[''data_file_name'']}}'
        - --feature_path
        - '{{$.outputs.artifacts[''features''].path}}'
        command:
        - python3
        - /pipelines/component/src/component.py
        image: us-central1-docker.pkg.dev/assignment1-402316/image-repo-group1/toxic-data-ingestor:0.0.1
pipelineInfo:
  name: toxic-predictor-mlp
root:
  dag:
    tasks:
      multilabel-classifier:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-multilabel-classifier
        dependentTasks:
        - toxic-data-cleaning
        inputs:
          artifacts:
            X_dtm:
              taskOutputArtifact:
                outputArtifactKey: X_dtm
                producerTask: toxic-data-cleaning
            y:
              taskOutputArtifact:
                outputArtifactKey: y
                producerTask: toxic-data-cleaning
          parameters:
            model_bucket:
              componentInputParameter: model_repo
            project:
              componentInputParameter: project_id
        taskInfo:
          name: multilabel-classifier
      toxic-data-cleaning:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-toxic-data-cleaning
        dependentTasks:
        - toxic-data-ingestion
        inputs:
          artifacts:
            features:
              taskOutputArtifact:
                outputArtifactKey: features
                producerTask: toxic-data-ingestion
        taskInfo:
          name: toxic-data-cleaning
      toxic-data-ingestion:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-toxic-data-ingestion
        inputs:
          parameters:
            bucket:
              componentInputParameter: data_bucket
            data_file_name:
              componentInputParameter: trainset_filename
            project:
              componentInputParameter: project_id
        taskInfo:
          name: toxic-data-ingestion
  inputDefinitions:
    parameters:
      data_bucket:
        parameterType: STRING
      model_repo:
        parameterType: STRING
      project_id:
        parameterType: STRING
      trainset_filename:
        parameterType: STRING
schemaVersion: 2.1.0
sdkVersion: kfp-2.3.0
